import{g as c}from"./chunk-KOI2BV3Z.js";import{a as p}from"./chunk-F4Q2XGET.js";import{Ac as u,J as a,M as l,S as s,i as o,m as i,x as n}from"./chunk-4EPYZPYR.js";var h=class t{constructor(){this.http=s(u);this.router=s(c);this.apiUrl=`${p.api.url}/users`;this.isAuthenticatedSubject=new o(this.hasToken());this.currentUserSubject=new o(this.getUserFromToken());this.isAuthenticated$=this.isAuthenticatedSubject.asObservable();this.currentUser$=this.currentUserSubject.asObservable()}hasToken(){return!!localStorage.getItem("authToken")}getUserFromToken(){let r=this.getToken();if(!r)return null;try{let e=JSON.parse(atob(r.split(".")[1]));return{sub:e.sub,role:e.role}}catch(e){return console.error("Token JWT inv\xE1lido.",e),this.logout(),null}}getCurrentUser(){return this.currentUserSubject.value}login(r){return this.http.post(`${this.apiUrl}/login`,r).pipe(a(e=>{localStorage.setItem("authToken",e.token),this.isAuthenticatedSubject.next(!0),this.currentUserSubject.next(this.getUserFromToken()),this.router.navigate(["/home"])}),n(this.handleError))}register(r){return console.log("API URL:",`${this.apiUrl}/register`),this.http.post(`${this.apiUrl}/register`,r).pipe(n(this.handleError))}logout(){localStorage.removeItem("authToken"),this.isAuthenticatedSubject.next(!1),this.currentUserSubject.next(null),this.router.navigate(["/login"])}getToken(){return localStorage.getItem("authToken")}getUserDisplayName(){return this.getCurrentUser()?.sub||"Usu\xE1rio"}handleError(r){let e=r.error?.message||"Ocorreu um erro desconhecido.";return i(()=>new Error(e))}static{this.\u0275fac=function(e){return new(e||t)}}static{this.\u0275prov=l({token:t,factory:t.\u0275fac,providedIn:"root"})}};export{h as a};
