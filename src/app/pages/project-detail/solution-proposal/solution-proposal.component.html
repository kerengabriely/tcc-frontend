<p-dialog
  [(visible)]="visible"
  [modal]="true"
  [closable]="true"
  [style]="{ width: '70vw' }"
  styleClass="solution-proposal-dialog"
>
  <ng-template pTemplate="header">
    <div class="modal-header">
      <h2>{{ project?.title || "Texto Título do Projeto" }}</h2>
      <p>
        <a [routerLink]="['/perfil-entrepreneur', project?.entrepreneur?.id || '1']" class="link-empresa">
          {{ project?.entrepreneur?.companyName || "Texto Empresa Anunciante" }}
        </a>
      </p>
    </div>
  </ng-template>

  <form [formGroup]="proposalForm" (ngSubmit)="submitProposal()" *ngIf="!submitted; else successTpl">
    <div class="detail-card">
      <h3>Solução ofertada</h3>
      <textarea
        pInputText
        formControlName="idea"
        placeholder="Informe a sua ideia de solução"
        class="w-full"
      ></textarea>
      <div *ngIf="proposalForm.get('idea')?.invalid && proposalForm.get('idea')?.touched" class="input-error">
        <small *ngIf="proposalForm.get('idea')?.hasError('required')">Ideia é obrigatória.</small>
        <small *ngIf="proposalForm.get('idea')?.hasError('minlength')">Ideia deve ter no mínimo 100 caracteres.</small>
      </div>
    </div>

    <div class="detail-card">
      <h3>Valor cobrado</h3>
      <p-inputNumber
        formControlName="value"
        mode="currency"
        currency="BRL"
        [minFractionDigits]="2"
        [maxFractionDigits]="2"
        [useGrouping]="true"
        [showButtons]="false"
        placeholder="Informe o valor"
        [allowEmpty]="true"
        (blur)="proposalForm.get('value')?.markAsTouched()"
      ></p-inputNumber>

      <div
        *ngIf="proposalForm.get('value')?.invalid && proposalForm.get('value')?.touched"
        class="input-error"
      >
        <small *ngIf="proposalForm.get('value')?.hasError('required')">O valor é obrigatório.</small>
        <small *ngIf="proposalForm.get('value')?.hasError('min')">Informe um valor válido (maior que zero).</small>
      </div>
    </div>

    <div class="hero-actions">
      <button
        pButton
        label="Cancelar"
        class="p-button-text btnVoltar"
        type="button"
        (click)="close()"
      ></button>
      <button
        pButton
        label="Enviar solução proposta"
        [disabled]="proposalForm.invalid || loading"
        class="p-button-rounded btnComecar"
        type="submit"
      ></button>
    </div>
  </form>

  <ng-template #successTpl>
    <div class="detail-card">
      <h3>Proposta enviada com sucesso</h3>
      <p>Agradecemos o envio da sua proposta. Em breve a empresa poderá analisá-la.</p>
      <div class="hero-actions">
        <button pButton label="Fechar" class="p-button-rounded btnComecar" (click)="close()"></button>
      </div>
    </div>
  </ng-template>
</p-dialog>
